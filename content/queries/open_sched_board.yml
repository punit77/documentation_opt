queries:
  - id: q1
    title: "Query 1"
    sql: |
      SELECT 
          SubStatusID, Description, SchedStatusID, SubStatusColor, IsDefault,
          IsActive, dbo.GetRowStamp(RecordID) AS RecordID
        FROM
          dbo.tblSchedSubStatus

      WHERE CAST(RecordID AS bigint)>320873146 ORDER BY CAST(RecordID AS bigint)

  - id: q2
    title: "Query 2"
    sql: |
      exec [sys].sp_describe_undeclared_parameters N'DECLARE
       @StartDate float(8),
       @EndDate float(8),
       @Status varchar(500),
       @ScheduleID int,
       @SvcDetailID varchar(16),
       @LoadBlob bit,

      --Added By Abhishek Anand
      --Added for Mobile issue (StarTDate and EndDate)
            @StartDate1 nvarchar(max),
            @EndDate1 nvarchar(max)
      SET  @StartDate1 = @P1
      SET  @EndDate1 = @P2
      SET @StartDate = CONVERT(float(8), CONVERT(datetime, ISNULL(@StartDate1, '''') ))
      SET @EndDate = CONVERT(float(8), CONVERT(datetime, ISNULL(@EndDate1, '''') ))
      --SET @StartDate = CONVERT(float(8), CONVERT(datetime, :StartDate))
      --SET @EndDate = CONVERT(float(8), CONVERT(datetime, :EndDate))
      SET @Status = ISNULL(@P3, '''')
      SET @ScheduleID = ISNULL(@P4, 0)
      SET @SvcDetailID = @P5
      SET @LoadBlob = @P6

      DECLARE
            @SchedIDList TABLE (RecID int)
      DECLARE
            @TechList TABLE (RecID int)

      INSERT INTO @SchedIDList
      SELECT RecID FROM dbo.fnGetStringTempTbl(@P7)

      IF (@ScheduleID > 0)
        INSERT INTO @SchedIDList (RecID) VALUES (@ScheduleID)


      INSERT INTO @TechList
      SELECT RecID FROM dbo.fnGetStringTempTbl(@P8)

      IF (SELECT COUNT(*) FROM @TechList) = 1 AND (SELECT TOP 1 RecID FROM @TechList) = -1
        DELETE @TechList


      IF (SELECT COUNT(*) FROM @SchedIDList) = 0

      SELECT     dbo.tblSvcOrderSched.ScheduleID, dbo.tblSvcOrderSched.SvcOrderID, dbo.tblSvcOrderSched.TechID, dbo.tblSvcOrderSched.EstRepairTime,
                            dbo.tblSvcOrderSched.SchedDate, dbo.tblSvcOrderSched.StartTime, dbo.tblSvcOrderSched.EndTime, dbo.tblSvcOrderSched.Status,
                dbo.tblSvcOrderSched.SchedSubStatusID,
                            dbo.tblSvcOrderSched.Priority, dbo.tblSvcOrderSched.SlotType, dbo.tblSvcOrderSched.SlotOptions, dbo.tblSvcOrderSched.SlotParentID,
                            dbo.tblSvcOrderSched.SlotRecurrenceIndex, dbo.tblSvcOrderSched.SlotRecurrenceInfo, dbo.tblSvcOrderSched.SlotReminderDisabled, dbo.tblSvcOrderSched.SlotMessage,
                            dbo.tblSvcOrderSched.SlotRecurrEndDate, dbo.tblSvcOrderSched.UserCreated, dbo.tblSvcOrderSched.TimeCreated,
                            dbo.tblSvcOrderSched.UserModified, dbo.tblSvcOrderSched.TimeModified, dbo.tblSvcOrderSched.RecordID, dbo.tblCustomer.CustName,
                            dbo.tblSvcOrderSched.ResidentID, dbo.tblSvcOrderSched.SvcDetailID, dbo.FtblSvcOrder.SvcTypeID, dbo.FtblSvcOrder.IsInstall,
                            dbo.FtblSvcOrder.RateTableID, dbo.tblSvcOrderSched.InvoiceDesc, dbo.tblSvcOrderSched.BillableHours, dbo.tblSvcOrderSched.PayTypeID,
                            dbo.tblSvcOrderSched.OvertimePayTypeID, dbo.tblSvcOrderSched.EmpPayTypeInfo, dbo.tblSvcOrderSched.EmpRegularBillHrs, dbo.tblSvcOrderSched.EmpOvertimeBillHrs,
                            dbo.tblSvcOrderSched.EmpRegularActualHrs, dbo.tblSvcOrderSched.EmpOvertimeActualHrs, tblSvcOrderSched.EmpWeekendBillHrs,
                            tblSvcOrderSched.EmpHolidayBillHrs, tblSvcOrderSched.EmpWeekendActualHrs, tblSvcOrderSched.EmpHolidayActualHrs, tblSvcOrderSched.LaborHours,
                            dbo.tblSvcOrderSched.ChargeCrewTech, dbo.tblSvcOrderSched.ShowInvCrewTech, dbo.tblSvcOrderSched.InRecurrence,
                            CAST((CASE WHEN (dbo.FtblSvcOrder.SalesTax = 1) AND (dbo.fnIsItemTaxable(dbo.FtblSvcOrder.TaxGrpID, 2) = 1)
                            THEN 1 ELSE 0 END) AS bit) AS SalesTax, dbo.FtblSvcOrder.TaxGrpID, dbo.FtblSvcOrder.CustSiteID, dbo.tblCustomerSite.SiteName,
                            dbo.tblSvcOrderSched.Sync, dbo.FtblSvcOrder.Status AS SvcStatus,

                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.Address2 ELSE tblCustomerSite.Address2 END) AS Address2,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.City ELSE tblCustomerSite.City END) AS City,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.State ELSE tblCustomerSite.State END) AS State,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.Zip ELSE tblCustomerSite.PostalCode END) AS Zip,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.Phone ELSE tblCustomerSite.Phone END) AS Phone,
                            tblCustSiteResident.Address1 AS ResidentName,
                            CAST(dbo.tblSvcOrderSched.RecordID AS bigint)
                            --dbo.GetRowStamp(dbo.tblSvcOrderSched.RecordID)
                            --CAST(dbo.tblSvcOrderSched.RecordID AS bigint)
                            AS RecordIDInt, dbo.tblSvcOrderSched.RepairCodeID, dbo.tblSvcOrderSched.RepairDesc, dbo.tblSvcOrderSched.TechNote,
                            dbo.tblSvcOrderSched.CancelReason, dbo.FtblSvcOrder.AgrmntID, dbo.FtblSvcOrder.CustEquipID, dbo.FtblSvcOrder.ShortDesc,
                            tblSvcOrderSched.TechList, CAST(NULL AS IMAGE) AS TechListImage, FtblSvcOrder.CustID,
      -- Alexey 3151
      --					tblSvcOrderSched.CustSignature,
                (CASE WHEN @LoadBlob = 1 THEN tblSvcOrderSched.CustSignature ELSE NULL END) AS CustSignature,

                tblSvcOrderSched.NameOfSig,
                            tblSvcOrderSched.AgrmntSchedID, FtblSvcOrder.SubstatusID AS SvcSubstatusID, FtblSvcOrder.LocationID AS BranchID,
                            dbo.tblCustomer.Phone AS CustPhone, dbo.FtblSvcOrder.CF1 AS WOCF1, dbo.FtblSvcOrder.CF2 AS WOCF2, dbo.FtblSvcOrder.CF3 AS WOCF3,
                            dbo.FtblSvcOrder.CF4 AS WOCF4, dbo.FtblSvcOrder.CF5 AS WOCF5, dbo.FtblSvcOrder.CF6 AS WOCF6, dbo.FtblSvcOrder.CF7 AS WOCF7,
                            dbo.FtblSvcOrder.CF8 AS WOCF8, dbo.FtblSvcOrder.CF9 AS WOCF9, dbo.FtblSvcOrder.CF10 AS WOCF10, dbo.FtblSvcOrder.CF11 AS WOCF11,
                            dbo.FtblSvcOrder.CF12 AS WOCF12, dbo.FtblSvcOrder.CF13 AS WOCF13, dbo.FtblSvcOrder.CF14 AS WOCF14, dbo.FtblSvcOrder.CF15 AS WOCF15,
                            dbo.FtblSvcOrder.CustPO,
                            CAST(0 AS bit) AS Post, 0 AS ChargeCrewTechType, 0 AS ShowInvCrewTechType, CAST(0 AS bit) AS DefaultValuesSet, ToBeInvoiced,
                            FollowUpRequired, FollowUpSchedID, FollowUpRepairCodeID, FollowUpMsg, CAST(NULL AS IMAGE) AS ReminderResourceInfo,
                            SubItemGroupID, tblSvcOrderSched.TotalTravelTime, tblSvcOrderSched.TotalTravelDistance, tblSvcOrderSched.EquipID,
      -- Alex Kop #3151
                            (CASE WHEN tblSvcOrderSched.CustSignature IS NULL THEN 0 ELSE 1 END) AS HasSignature,
                            ISNULL(@LoadBlob, 0) AS BlobsLoaded,tblSvcOrderSched.CustEquipIDList,tblSvcOrderSched.CustEquipNameList
                            ,dbo.tblCustomer.AltAccountNo
      -- #3151
      FROM         dbo.FtblSvcOrder INNER JOIN
                            dbo.tblSvcOrderSched ON dbo.FtblSvcOrder.SvcOrderID = dbo.tblSvcOrderSched.SvcOrderID INNER JOIN
                            dbo.tblCustomer ON dbo.FtblSvcOrder.CustID = dbo.tblCustomer.CustID INNER JOIN
                            dbo.tblCustomerSite ON dbo.FtblSvcOrder.CustSiteID = dbo.tblCustomerSite.CustSiteID LEFT OUTER JOIN
                            dbo.tblCustSiteResident ON dbo.tblSvcOrderSched.ResidentID = dbo.tblCustSiteResident.ResidentID


      WHERE
          ((@ScheduleID > 0) AND (ScheduleID = @ScheduleID))
          OR
          ((@StartDate = 0 OR @EndDate = 0) OR
          ((CONVERT(float(8), tblSvcOrderSched.StartTime) between @StartDate and @EndDate)
          OR
          (CONVERT(float(8), tblSvcOrderSched.EndTime) between @StartDate and @EndDate)
          OR
          (CONVERT(float(8), tblSvcOrderSched.SlotRecurrEndDate) between @StartDate and @EndDate)
          OR
          (@StartDate BETWEEN tblSvcOrderSched.StartTime AND tblSvcOrderSched.EndTIme)
          OR
          (@EndDate BETWEEN tblSvcOrderSched.StartTime AND tblSvcOrderSched.EndTIme)))
          AND
          (((SELECT COUNT(*) FROM @SchedIDList) = 0) OR (dbo.tblSvcOrderSched.ScheduleID IN (SElECT RecID FROM @SchedIDList)))
          AND
          (((SELECT COUNT(*) FROM @TechList) = 0) OR (dbo.tblSvcOrderSched.ScheduleID IN (SELECT ScheduleID FROM tblSvcOrderSchedTech WHERE EmployeeID IN (SELECT RecID FROM @TechList))))
          AND
          ((@Status = '''') OR (dbo.tblSvcOrderSched.Status IN (SElECT RecID FROM fnGetStringTempTbl(@Status))))
          AND
          ((@SvcDetailID = '''') OR  (@SvcDetailID is null) OR (ISNULL(dbo.tblSvcOrderSched.SvcDetailID, 0) = 0))   --Added for Berlin issue fix

      ELSE


      SELECT     dbo.tblSvcOrderSched.ScheduleID, dbo.tblSvcOrderSched.SvcOrderID, dbo.tblSvcOrderSched.TechID, dbo.tblSvcOrderSched.EstRepairTime,
                            dbo.tblSvcOrderSched.SchedDate, dbo.tblSvcOrderSched.StartTime, dbo.tblSvcOrderSched.EndTime, dbo.tblSvcOrderSched.Status,
                            dbo.tblSvcOrderSched.SchedSubStatusID,
                            dbo.tblSvcOrderSched.Priority, dbo.tblSvcOrderSched.SlotType, dbo.tblSvcOrderSched.SlotOptions, dbo.tblSvcOrderSched.SlotParentID,
                            dbo.tblSvcOrderSched.SlotRecurrenceIndex, dbo.tblSvcOrderSched.SlotRecurrenceInfo, dbo.tblSvcOrderSched.SlotReminderDisabled, dbo.tblSvcOrderSched.SlotMessage,
                            dbo.tblSvcOrderSched.SlotRecurrEndDate, dbo.tblSvcOrderSched.UserCreated, dbo.tblSvcOrderSched.TimeCreated,
                            dbo.tblSvcOrderSched.UserModified, dbo.tblSvcOrderSched.TimeModified, dbo.tblSvcOrderSched.RecordID, dbo.tblCustomer.CustName,
                            dbo.tblSvcOrderSched.ResidentID, dbo.tblSvcOrderSched.SvcDetailID, dbo.FtblSvcOrder.SvcTypeID, dbo.FtblSvcOrder.IsInstall,
                            dbo.FtblSvcOrder.RateTableID, dbo.tblSvcOrderSched.InvoiceDesc, dbo.tblSvcOrderSched.BillableHours, dbo.tblSvcOrderSched.PayTypeID,
                            dbo.tblSvcOrderSched.OvertimePayTypeID, dbo.tblSvcOrderSched.EmpPayTypeInfo, dbo.tblSvcOrderSched.EmpRegularBillHrs, dbo.tblSvcOrderSched.EmpOvertimeBillHrs,
                            dbo.tblSvcOrderSched.EmpRegularActualHrs, dbo.tblSvcOrderSched.EmpOvertimeActualHrs, tblSvcOrderSched.EmpWeekendBillHrs,
                            tblSvcOrderSched.EmpHolidayBillHrs, tblSvcOrderSched.EmpWeekendActualHrs, tblSvcOrderSched.EmpHolidayActualHrs, tblSvcOrderSched.LaborHours,
                            dbo.tblSvcOrderSched.ChargeCrewTech, dbo.tblSvcOrderSched.ShowInvCrewTech, dbo.tblSvcOrderSched.InRecurrence,
                            CAST((CASE WHEN (dbo.FtblSvcOrder.SalesTax = 1) AND (dbo.fnIsItemTaxable(dbo.FtblSvcOrder.TaxGrpID, 2) = 1)
                            THEN 1 ELSE 0 END) AS bit) AS SalesTax, dbo.FtblSvcOrder.TaxGrpID, dbo.FtblSvcOrder.CustSiteID, dbo.tblCustomerSite.SiteName,
                            dbo.tblSvcOrderSched.Sync, dbo.FtblSvcOrder.Status AS SvcStatus,

                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.Address2 ELSE tblCustomerSite.Address2 END) AS Address2,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.City ELSE tblCustomerSite.City END) AS City,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.State ELSE tblCustomerSite.State END) AS State,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.Zip ELSE tblCustomerSite.PostalCode END) AS Zip,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.Phone ELSE tblCustomerSite.Phone END) AS Phone,
                            tblCustSiteResident.Address1 AS ResidentName,
                            CAST(dbo.tblSvcOrderSched.RecordID AS bigint)
                            --dbo.GetRowStamp(dbo.tblSvcOrderSched.RecordID)
                            --CAST(dbo.tblSvcOrderSched.RecordID AS int)
                            AS RecordIDInt, dbo.tblSvcOrderSched.RepairCodeID, dbo.tblSvcOrderSched.RepairDesc, dbo.tblSvcOrderSched.TechNote,
                            dbo.tblSvcOrderSched.CancelReason, dbo.FtblSvcOrder.AgrmntID, dbo.FtblSvcOrder.CustEquipID, dbo.FtblSvcOrder.ShortDesc,
                            tblSvcOrderSched.TechList, CAST(NULL AS IMAGE) AS TechListImage, FtblSvcOrder.CustID,

      -- Alexey 3151
      --					tblSvcOrderSched.CustSignature,
                (CASE WHEN @LoadBlob = 1 THEN tblSvcOrderSched.CustSignature ELSE NULL END) AS CustSignature,

                tblSvcOrderSched.NameOfSig,
                            tblSvcOrderSched.AgrmntSchedID, FtblSvcOrder.SubstatusID AS SvcSubstatusID, FtblSvcOrder.LocationID AS BranchID,
                            dbo.tblCustomer.Phone AS CustPhone, dbo.FtblSvcOrder.CF1 AS WOCF1, dbo.FtblSvcOrder.CF2 AS WOCF2, dbo.FtblSvcOrder.CF3 AS WOCF3,
                            dbo.FtblSvcOrder.CF4 AS WOCF4, dbo.FtblSvcOrder.CF5 AS WOCF5, dbo.FtblSvcOrder.CF6 AS WOCF6, dbo.FtblSvcOrder.CF7 AS WOCF7,
                            dbo.FtblSvcOrder.CF8 AS WOCF8, dbo.FtblSvcOrder.CF9 AS WOCF9, dbo.FtblSvcOrder.CF10 AS WOCF10, dbo.FtblSvcOrder.CF11 AS WOCF11,
                            dbo.FtblSvcOrder.CF12 AS WOCF12, dbo.FtblSvcOrder.CF13 AS WOCF13, dbo.FtblSvcOrder.CF14 AS WOCF14, dbo.FtblSvcOrder.CF15 AS WOCF15,
                            dbo.FtblSvcOrder.CustPO,
                            CAST(0 AS bit) AS Post, 0 AS ChargeCrewTechType, 0 AS ShowInvCrewTechType, CAST(0 AS bit) AS DefaultValuesSet, ToBeInvoiced,
                            FollowUpRequired, FollowUpSchedID, FollowUpRepairCodeID, FollowUpMsg, CAST(NULL AS IMAGE) AS ReminderResourceInfo,
                            SubItemGroupID, tblSvcOrderSched.TotalTravelTime, tblSvcOrderSched.TotalTravelDistance, tblSvcOrderSched.EquipID,
      -- Alex Kop #3151
                            (CASE WHEN tblSvcOrderSched.CustSignature IS NULL THEN 0 ELSE 1 END) AS HasSignature,
                            ISNULL(@LoadBlob, 0) AS BlobsLoaded,tblSvcOrderSched.CustEquipIDList,tblSvcOrderSched.CustEquipNameList
                            ,dbo.tblCustomer.AltAccountNo
      -- #3151
      FROM         dbo.FtblSvcOrder INNER JOIN
                            dbo.tblSvcOrderSched ON dbo.FtblSvcOrder.SvcOrderID = dbo.tblSvcOrderSched.SvcOrderID INNER JOIN
                            dbo.tblCustomer ON dbo.FtblSvcOrder.CustID = dbo.tblCustomer.CustID INNER JOIN
                            dbo.tblCustomerSite ON dbo.FtblSvcOrder.CustSiteID = dbo.tblCustomerSite.CustSiteID LEFT OUTER JOIN
                            dbo.tblCustSiteResident ON dbo.tblSvcOrderSched.ResidentID = dbo.tblCustSiteResident.ResidentID


      WHERE
          (dbo.tblSvcOrderSched.ScheduleID IN (SElECT RecID FROM @SchedIDList))'


  - id: q3
    title: "Query 3"
    sql: |
      exec sp_executesql N'DECLARE
            @StartDate float(8),
            @EndDate float(8),
            @Status varchar(500),
            @ScheduleID int,
            @SvcDetailID varchar(16),
            @LoadBlob bit,

      --Added By Abhishek Anand
      --Added for Mobile issue (StarTDate and EndDate)
            @StartDate1 nvarchar(max),
            @EndDate1 nvarchar(max)
      SET  @StartDate1 = @P1
      SET  @EndDate1 = @P2
      SET @StartDate = CONVERT(float(8), CONVERT(datetime, ISNULL(@StartDate1, '''') ))
      SET @EndDate = CONVERT(float(8), CONVERT(datetime, ISNULL(@EndDate1, '''') ))
      --SET @StartDate = CONVERT(float(8), CONVERT(datetime, :StartDate))
      --SET @EndDate = CONVERT(float(8), CONVERT(datetime, :EndDate))
      SET @Status = ISNULL(@P3, '''')
      SET @ScheduleID = ISNULL(@P4, 0)
      SET @SvcDetailID = @P5
      SET @LoadBlob = @P6

      DECLARE
            @SchedIDList TABLE (RecID int)
      DECLARE
            @TechList TABLE (RecID int)

      INSERT INTO @SchedIDList
      SELECT RecID FROM dbo.fnGetStringTempTbl(@P7)

      IF (@ScheduleID > 0)
        INSERT INTO @SchedIDList (RecID) VALUES (@ScheduleID)


      INSERT INTO @TechList
      SELECT RecID FROM dbo.fnGetStringTempTbl(@P8)

      IF (SELECT COUNT(*) FROM @TechList) = 1 AND (SELECT TOP 1 RecID FROM @TechList) = -1
        DELETE @TechList


      IF (SELECT COUNT(*) FROM @SchedIDList) = 0

      SELECT     dbo.tblSvcOrderSched.ScheduleID, dbo.tblSvcOrderSched.SvcOrderID, dbo.tblSvcOrderSched.TechID, dbo.tblSvcOrderSched.EstRepairTime,
                            dbo.tblSvcOrderSched.SchedDate, dbo.tblSvcOrderSched.StartTime, dbo.tblSvcOrderSched.EndTime, dbo.tblSvcOrderSched.Status,
                dbo.tblSvcOrderSched.SchedSubStatusID,
                            dbo.tblSvcOrderSched.Priority, dbo.tblSvcOrderSched.SlotType, dbo.tblSvcOrderSched.SlotOptions, dbo.tblSvcOrderSched.SlotParentID,
                            dbo.tblSvcOrderSched.SlotRecurrenceIndex, dbo.tblSvcOrderSched.SlotRecurrenceInfo, dbo.tblSvcOrderSched.SlotReminderDisabled, dbo.tblSvcOrderSched.SlotMessage,
                            dbo.tblSvcOrderSched.SlotRecurrEndDate, dbo.tblSvcOrderSched.UserCreated, dbo.tblSvcOrderSched.TimeCreated,
                            dbo.tblSvcOrderSched.UserModified, dbo.tblSvcOrderSched.TimeModified, dbo.tblSvcOrderSched.RecordID, dbo.tblCustomer.CustName,
                            dbo.tblSvcOrderSched.ResidentID, dbo.tblSvcOrderSched.SvcDetailID, dbo.FtblSvcOrder.SvcTypeID, dbo.FtblSvcOrder.IsInstall,
                            dbo.FtblSvcOrder.RateTableID, dbo.tblSvcOrderSched.InvoiceDesc, dbo.tblSvcOrderSched.BillableHours, dbo.tblSvcOrderSched.PayTypeID,
                            dbo.tblSvcOrderSched.OvertimePayTypeID, dbo.tblSvcOrderSched.EmpPayTypeInfo, dbo.tblSvcOrderSched.EmpRegularBillHrs, dbo.tblSvcOrderSched.EmpOvertimeBillHrs,
                            dbo.tblSvcOrderSched.EmpRegularActualHrs, dbo.tblSvcOrderSched.EmpOvertimeActualHrs, tblSvcOrderSched.EmpWeekendBillHrs,
                            tblSvcOrderSched.EmpHolidayBillHrs, tblSvcOrderSched.EmpWeekendActualHrs, tblSvcOrderSched.EmpHolidayActualHrs, tblSvcOrderSched.LaborHours,
                            dbo.tblSvcOrderSched.ChargeCrewTech, dbo.tblSvcOrderSched.ShowInvCrewTech, dbo.tblSvcOrderSched.InRecurrence,
                            CAST((CASE WHEN (dbo.FtblSvcOrder.SalesTax = 1) AND (dbo.fnIsItemTaxable(dbo.FtblSvcOrder.TaxGrpID, 2) = 1)
                            THEN 1 ELSE 0 END) AS bit) AS SalesTax, dbo.FtblSvcOrder.TaxGrpID, dbo.FtblSvcOrder.CustSiteID, dbo.tblCustomerSite.SiteName,
                            dbo.tblSvcOrderSched.Sync, dbo.FtblSvcOrder.Status AS SvcStatus,

                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.Address2 ELSE tblCustomerSite.Address2 END) AS Address2,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.City ELSE tblCustomerSite.City END) AS City,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.State ELSE tblCustomerSite.State END) AS State,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.Zip ELSE tblCustomerSite.PostalCode END) AS Zip,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.Phone ELSE tblCustomerSite.Phone END) AS Phone,
                            tblCustSiteResident.Address1 AS ResidentName,
                            CAST(dbo.tblSvcOrderSched.RecordID AS bigint)
                            --dbo.GetRowStamp(dbo.tblSvcOrderSched.RecordID)
                            --CAST(dbo.tblSvcOrderSched.RecordID AS bigint)
                            AS RecordIDInt, dbo.tblSvcOrderSched.RepairCodeID, dbo.tblSvcOrderSched.RepairDesc, dbo.tblSvcOrderSched.TechNote,
                            dbo.tblSvcOrderSched.CancelReason, dbo.FtblSvcOrder.AgrmntID, dbo.FtblSvcOrder.CustEquipID, dbo.FtblSvcOrder.ShortDesc,
                            tblSvcOrderSched.TechList, CAST(NULL AS IMAGE) AS TechListImage, FtblSvcOrder.CustID,
      -- Alexey 3151
      --					tblSvcOrderSched.CustSignature,
                (CASE WHEN @LoadBlob = 1 THEN tblSvcOrderSched.CustSignature ELSE NULL END) AS CustSignature,

                tblSvcOrderSched.NameOfSig,
                            tblSvcOrderSched.AgrmntSchedID, FtblSvcOrder.SubstatusID AS SvcSubstatusID, FtblSvcOrder.LocationID AS BranchID,
                            dbo.tblCustomer.Phone AS CustPhone, dbo.FtblSvcOrder.CF1 AS WOCF1, dbo.FtblSvcOrder.CF2 AS WOCF2, dbo.FtblSvcOrder.CF3 AS WOCF3,
                            dbo.FtblSvcOrder.CF4 AS WOCF4, dbo.FtblSvcOrder.CF5 AS WOCF5, dbo.FtblSvcOrder.CF6 AS WOCF6, dbo.FtblSvcOrder.CF7 AS WOCF7,
                            dbo.FtblSvcOrder.CF8 AS WOCF8, dbo.FtblSvcOrder.CF9 AS WOCF9, dbo.FtblSvcOrder.CF10 AS WOCF10, dbo.FtblSvcOrder.CF11 AS WOCF11,
                            dbo.FtblSvcOrder.CF12 AS WOCF12, dbo.FtblSvcOrder.CF13 AS WOCF13, dbo.FtblSvcOrder.CF14 AS WOCF14, dbo.FtblSvcOrder.CF15 AS WOCF15,
                            dbo.FtblSvcOrder.CustPO,
                            CAST(0 AS bit) AS Post, 0 AS ChargeCrewTechType, 0 AS ShowInvCrewTechType, CAST(0 AS bit) AS DefaultValuesSet, ToBeInvoiced,
                            FollowUpRequired, FollowUpSchedID, FollowUpRepairCodeID, FollowUpMsg, CAST(NULL AS IMAGE) AS ReminderResourceInfo,
                            SubItemGroupID, tblSvcOrderSched.TotalTravelTime, tblSvcOrderSched.TotalTravelDistance, tblSvcOrderSched.EquipID,
      -- Alex Kop #3151
                            (CASE WHEN tblSvcOrderSched.CustSignature IS NULL THEN 0 ELSE 1 END) AS HasSignature,
                            ISNULL(@LoadBlob, 0) AS BlobsLoaded,tblSvcOrderSched.CustEquipIDList,tblSvcOrderSched.CustEquipNameList
                            ,dbo.tblCustomer.AltAccountNo
      -- #3151
      FROM         dbo.FtblSvcOrder INNER JOIN
                            dbo.tblSvcOrderSched ON dbo.FtblSvcOrder.SvcOrderID = dbo.tblSvcOrderSched.SvcOrderID INNER JOIN
                            dbo.tblCustomer ON dbo.FtblSvcOrder.CustID = dbo.tblCustomer.CustID INNER JOIN
                            dbo.tblCustomerSite ON dbo.FtblSvcOrder.CustSiteID = dbo.tblCustomerSite.CustSiteID LEFT OUTER JOIN
                            dbo.tblCustSiteResident ON dbo.tblSvcOrderSched.ResidentID = dbo.tblCustSiteResident.ResidentID


      WHERE
          ((@ScheduleID > 0) AND (ScheduleID = @ScheduleID))
          OR
          ((@StartDate = 0 OR @EndDate = 0) OR
          ((CONVERT(float(8), tblSvcOrderSched.StartTime) between @StartDate and @EndDate)
          OR
          (CONVERT(float(8), tblSvcOrderSched.EndTime) between @StartDate and @EndDate)
          OR
          (CONVERT(float(8), tblSvcOrderSched.SlotRecurrEndDate) between @StartDate and @EndDate)
          OR
          (@StartDate BETWEEN tblSvcOrderSched.StartTime AND tblSvcOrderSched.EndTIme)
          OR
          (@EndDate BETWEEN tblSvcOrderSched.StartTime AND tblSvcOrderSched.EndTIme)))
          AND
          (((SELECT COUNT(*) FROM @SchedIDList) = 0) OR (dbo.tblSvcOrderSched.ScheduleID IN (SElECT RecID FROM @SchedIDList)))
          AND
          (((SELECT COUNT(*) FROM @TechList) = 0) OR (dbo.tblSvcOrderSched.ScheduleID IN (SELECT ScheduleID FROM tblSvcOrderSchedTech WHERE EmployeeID IN (SELECT RecID FROM @TechList))))
          AND
          ((@Status = '''') OR (dbo.tblSvcOrderSched.Status IN (SElECT RecID FROM fnGetStringTempTbl(@Status))))
          AND
          ((@SvcDetailID = '''') OR  (@SvcDetailID is null) OR (ISNULL(dbo.tblSvcOrderSched.SvcDetailID, 0) = 0))   --Added for Berlin issue fix

      ELSE


      SELECT     dbo.tblSvcOrderSched.ScheduleID, dbo.tblSvcOrderSched.SvcOrderID, dbo.tblSvcOrderSched.TechID, dbo.tblSvcOrderSched.EstRepairTime,
                            dbo.tblSvcOrderSched.SchedDate, dbo.tblSvcOrderSched.StartTime, dbo.tblSvcOrderSched.EndTime, dbo.tblSvcOrderSched.Status,
                            dbo.tblSvcOrderSched.SchedSubStatusID,
                            dbo.tblSvcOrderSched.Priority, dbo.tblSvcOrderSched.SlotType, dbo.tblSvcOrderSched.SlotOptions, dbo.tblSvcOrderSched.SlotParentID,
                            dbo.tblSvcOrderSched.SlotRecurrenceIndex, dbo.tblSvcOrderSched.SlotRecurrenceInfo, dbo.tblSvcOrderSched.SlotReminderDisabled, dbo.tblSvcOrderSched.SlotMessage,
                            dbo.tblSvcOrderSched.SlotRecurrEndDate, dbo.tblSvcOrderSched.UserCreated, dbo.tblSvcOrderSched.TimeCreated,
                            dbo.tblSvcOrderSched.UserModified, dbo.tblSvcOrderSched.TimeModified, dbo.tblSvcOrderSched.RecordID, dbo.tblCustomer.CustName,
                            dbo.tblSvcOrderSched.ResidentID, dbo.tblSvcOrderSched.SvcDetailID, dbo.FtblSvcOrder.SvcTypeID, dbo.FtblSvcOrder.IsInstall,
                            dbo.FtblSvcOrder.RateTableID, dbo.tblSvcOrderSched.InvoiceDesc, dbo.tblSvcOrderSched.BillableHours, dbo.tblSvcOrderSched.PayTypeID,
                            dbo.tblSvcOrderSched.OvertimePayTypeID, dbo.tblSvcOrderSched.EmpPayTypeInfo, dbo.tblSvcOrderSched.EmpRegularBillHrs, dbo.tblSvcOrderSched.EmpOvertimeBillHrs,
                            dbo.tblSvcOrderSched.EmpRegularActualHrs, dbo.tblSvcOrderSched.EmpOvertimeActualHrs, tblSvcOrderSched.EmpWeekendBillHrs,
                            tblSvcOrderSched.EmpHolidayBillHrs, tblSvcOrderSched.EmpWeekendActualHrs, tblSvcOrderSched.EmpHolidayActualHrs, tblSvcOrderSched.LaborHours,
                            dbo.tblSvcOrderSched.ChargeCrewTech, dbo.tblSvcOrderSched.ShowInvCrewTech, dbo.tblSvcOrderSched.InRecurrence,
                            CAST((CASE WHEN (dbo.FtblSvcOrder.SalesTax = 1) AND (dbo.fnIsItemTaxable(dbo.FtblSvcOrder.TaxGrpID, 2) = 1)
                            THEN 1 ELSE 0 END) AS bit) AS SalesTax, dbo.FtblSvcOrder.TaxGrpID, dbo.FtblSvcOrder.CustSiteID, dbo.tblCustomerSite.SiteName,
                            dbo.tblSvcOrderSched.Sync, dbo.FtblSvcOrder.Status AS SvcStatus,

                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.Address2 ELSE tblCustomerSite.Address2 END) AS Address2,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.City ELSE tblCustomerSite.City END) AS City,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.State ELSE tblCustomerSite.State END) AS State,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.Zip ELSE tblCustomerSite.PostalCode END) AS Zip,
                            (CASE WHEN (ISNULL(tblSvcOrderSched.ResidentID, 0) > 0) THEN tblCustSiteResident.Phone ELSE tblCustomerSite.Phone END) AS Phone,
                            tblCustSiteResident.Address1 AS ResidentName,
                            CAST(dbo.tblSvcOrderSched.RecordID AS bigint)
                            --dbo.GetRowStamp(dbo.tblSvcOrderSched.RecordID)
                            --CAST(dbo.tblSvcOrderSched.RecordID AS int)
                            AS RecordIDInt, dbo.tblSvcOrderSched.RepairCodeID, dbo.tblSvcOrderSched.RepairDesc, dbo.tblSvcOrderSched.TechNote,
                            dbo.tblSvcOrderSched.CancelReason, dbo.FtblSvcOrder.AgrmntID, dbo.FtblSvcOrder.CustEquipID, dbo.FtblSvcOrder.ShortDesc,
                            tblSvcOrderSched.TechList, CAST(NULL AS IMAGE) AS TechListImage, FtblSvcOrder.CustID,

      -- Alexey 3151
      --					tblSvcOrderSched.CustSignature,
                (CASE WHEN @LoadBlob = 1 THEN tblSvcOrderSched.CustSignature ELSE NULL END) AS CustSignature,

                tblSvcOrderSched.NameOfSig,
                            tblSvcOrderSched.AgrmntSchedID, FtblSvcOrder.SubstatusID AS SvcSubstatusID, FtblSvcOrder.LocationID AS BranchID,
                            dbo.tblCustomer.Phone AS CustPhone, dbo.FtblSvcOrder.CF1 AS WOCF1, dbo.FtblSvcOrder.CF2 AS WOCF2, dbo.FtblSvcOrder.CF3 AS WOCF3,
                            dbo.FtblSvcOrder.CF4 AS WOCF4, dbo.FtblSvcOrder.CF5 AS WOCF5, dbo.FtblSvcOrder.CF6 AS WOCF6, dbo.FtblSvcOrder.CF7 AS WOCF7,
                            dbo.FtblSvcOrder.CF8 AS WOCF8, dbo.FtblSvcOrder.CF9 AS WOCF9, dbo.FtblSvcOrder.CF10 AS WOCF10, dbo.FtblSvcOrder.CF11 AS WOCF11,
                            dbo.FtblSvcOrder.CF12 AS WOCF12, dbo.FtblSvcOrder.CF13 AS WOCF13, dbo.FtblSvcOrder.CF14 AS WOCF14, dbo.FtblSvcOrder.CF15 AS WOCF15,
                            dbo.FtblSvcOrder.CustPO,
                            CAST(0 AS bit) AS Post, 0 AS ChargeCrewTechType, 0 AS ShowInvCrewTechType, CAST(0 AS bit) AS DefaultValuesSet, ToBeInvoiced,
                            FollowUpRequired, FollowUpSchedID, FollowUpRepairCodeID, FollowUpMsg, CAST(NULL AS IMAGE) AS ReminderResourceInfo,
                            SubItemGroupID, tblSvcOrderSched.TotalTravelTime, tblSvcOrderSched.TotalTravelDistance, tblSvcOrderSched.EquipID,
      -- Alex Kop #3151
                            (CASE WHEN tblSvcOrderSched.CustSignature IS NULL THEN 0 ELSE 1 END) AS HasSignature,
                            ISNULL(@LoadBlob, 0) AS BlobsLoaded,tblSvcOrderSched.CustEquipIDList,tblSvcOrderSched.CustEquipNameList
                            ,dbo.tblCustomer.AltAccountNo
      -- #3151
      FROM         dbo.FtblSvcOrder INNER JOIN
                            dbo.tblSvcOrderSched ON dbo.FtblSvcOrder.SvcOrderID = dbo.tblSvcOrderSched.SvcOrderID INNER JOIN
                            dbo.tblCustomer ON dbo.FtblSvcOrder.CustID = dbo.tblCustomer.CustID INNER JOIN
                            dbo.tblCustomerSite ON dbo.FtblSvcOrder.CustSiteID = dbo.tblCustomerSite.CustSiteID LEFT OUTER JOIN
                            dbo.tblCustSiteResident ON dbo.tblSvcOrderSched.ResidentID = dbo.tblCustSiteResident.ResidentID


      WHERE
          (dbo.tblSvcOrderSched.ScheduleID IN (SElECT RecID FROM @SchedIDList))',N'@P1 nvarchar(max),@P2 nvarchar(max),
          @P3 varchar(8000),@P4 int,@P5 varchar(16),@P6 bit,@P7 text,@P8 text',N'12/5/2025',N'12/5/2025 11:59:59 PM',NULL,NULL,NULL,1,NULL,'-1'